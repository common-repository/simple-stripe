var stripe=Stripe(simple_stripe_new.publishable_key),elements=stripe.elements(),ss_input_amount,ss_uniqid,hidepostalcode,simple_stripe_amount=document.getElementsByClassName("simple_stripe_amount");hidepostalcode="true"==simple_stripe_amount[0].dataset.hidepostalcode;var card=elements.create("card",{style:{base:{},invalid:{}},hidePostalCode:hidepostalcode});function stripeTokenHandler(token,paymentMethod_id){var amount=Number(ss_input_amount.value),message_box=document.getElementById("card-status_"+ss_uniqid);if(-1===["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","UGX","VND","VUV","XAF","XOF","XPF"].indexOf(ss_input_amount.getAttribute("data-currency"))&&(amount*=100),message_box.style.display="inline-block",""!==ss_input_amount.getAttribute("data-minimum_amount")&&amount<Number(ss_input_amount.getAttribute("data-minimum_amount")))return message_box.style.border="4px solid #ffc937",message_box.style.backgroundColor="#fff9f0",message_box.innerHTML=simple_stripe_new.msg_minimum_amount,void(document.getElementById("pay_"+ss_uniqid).style.display="inline-block");message_box.innerHTML="",message_box.style.border="none";var form=document.getElementById("payment-form_"+ss_uniqid),hiddenInput=document.createElement("input");hiddenInput.setAttribute("type","hidden"),hiddenInput.setAttribute("name","stripeToken"),hiddenInput.setAttribute("value",token.id),form.appendChild(hiddenInput);var data={action:"simple_stripe_ajax",nonce:simple_stripe_new.nonce,token:token.id,paymentMethod_id:paymentMethod_id,amount:parseInt(amount),description:ss_input_amount.getAttribute("data-description"),currency:ss_input_amount.getAttribute("data-currency"),return_url:ss_input_amount.getAttribute("data-return_url"),here_url:ss_input_amount.getAttribute("data-here_url")},xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4===xhr.readyState){var msg=JSON.parse(xhr.response);200===xhr.status&&"OK"===msg.message?(message_box.style.border="4px solid #7cbc77",message_box.style.backgroundColor="#f0f9ef",message_box.innerHTML=simple_stripe_new.msg_successful,document.getElementById("pay_"+ss_uniqid).style.display="inline-block",""!==simple_stripe_new.redirect_url_success_pay&&(document.location.href=simple_stripe_new.redirect_url_success_pay)):(message_box.style.border="4px solid #f98a89",message_box.style.backgroundColor="#fff5f5",message_box.innerHTML=simple_stripe_new.msg_failed+"<br>"+msg.message,document.getElementById("pay_"+ss_uniqid).style.display="inline-block")}else message_box.style.border="4px solid #bdbabd",message_box.style.backgroundColor="#eeeeee",message_box.innerHTML=simple_stripe_new.msg_connecting},xhr.open("POST",simple_stripe_new.admin_ajax,!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.send(encodeURI(simple_stripe_new_encodeURI(data)))}function simple_stripe_createToken(e){var pay_btn=document.getElementById(e.target.id);ss_input_amount=document.querySelector("#"+e.target.id.replace("pay_","payment-form_")+" .simple_stripe_amount"),ss_uniqid=ss_input_amount.getAttribute("data-uniqid"),pay_btn.style.display="none",e.preventDefault(),stripe.createToken(card).then((function(result){var errorElement;result.error?(document.getElementById("card-errors_"+ss_uniqid).textContent=result.error.message,pay_btn.style.display="inline-block"):stripe.createPaymentMethod("card",card).then((function(result2){result2.error||stripeTokenHandler(result.token,result2.paymentMethod.id)})).catch((function(){}))}))}function simple_stripe_new_encodeURI(obj){var result="",splitter="";return"object"==typeof obj&&Object.keys(obj).forEach((function(key){result+=splitter+key+"="+encodeURIComponent(obj[key]),splitter="&"})),result}function simple_stripe_amount_key(k){if(!(k>=48&&k<=57||k>=96&&k<=105||8==k||46==k||39==k||37==k||110==k))return!1}card.mount(".ss_card-element"),card.addEventListener("change",(function(event){var displayError=document.getElementById("card-errors_"+card._parent.parentElement.parentElement[0].getAttribute("data-uniqid"));event.error?displayError.textContent=event.error.message:displayError.textContent=""}));